{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Group Chat</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'chat/css/home.css' %}?v=2" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <h2 class="nav-logo">GroupChat</h2>
            <ul class="nav-links">
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'browse_rooms' %}">Browse Rooms</a></li>
                <li><a href="https://github.com/MayANKPaTeL2303">GitHub</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>
    </nav>

    <div class="flex-container">
      <!-- Project Description -->
      <div class="project-description">
        <h2 class="section-title text-blue-600">About This Project</h2>
        <div class="chat-description">
          <p>
            <strong>Real-Time Group Chat Application</strong><br />
            This is a powerful and responsive chat platform developed using the
            <em>Django web framework</em> along with <em>WebSockets</em> to
            deliver seamless real-time communication.
          </p>

          <p>
            Users can <strong>create</strong> a new chat room or
            <strong>join</strong> an existing one using a unique room code. Once
            inside a room, messages are broadcast to all participants
            <strong>instantly</strong>, without the need for refreshing the
            page.
          </p>

          <p>
            The app uses <strong>Django Channels</strong> to handle asynchronous
            communication, and <strong>Redis</strong> as a high-performance
            channel layer to manage routing and message flow. Redis plays a key
            role in ensuring scalability and responsiveness by serving as an
            <em>in-memory message broker</em>, efficiently distributing messages
            across users and processes.
          </p>
        </div>
      </div>

      <!-- Chat Box -->
      <div class="chat-box">
        <h1 class="heading">Group Chat</h1>

        <!-- Create Room -->
        <div class="section-block">
          <h2 class="section-title indigo">Create Room</h2>
          <form
            method="get"
            action="{% url 'create_room' %}"
            class="form-block"
          >
            <input
              type="text"
              name="username"
              placeholder="Enter your name"
              required
              maxlength="150"
            />
            <input
              type="text"
              name="room_name"
              placeholder="Room name (optional) - e.g., Study Group, Game Night"
              maxlength="200"
            />
            <button type="submit" class="create-btn">Create Room</button>
          </form>
        </div>

        <!-- Join Room -->
        <div class="section-block">
          <h2 class="section-title green">Join Room</h2>
          <form method="post" action="{% url 'join_room' %}" class="form-block">
            {% csrf_token %}
            <input
              type="text"
              name="room_code"
              placeholder="Room Code"
              required
            />
            <input
              type="text"
              name="username"
              placeholder="Enter your name"
              required
            />
            <button type="submit" class="join-btn">Join</button>
          </form>
        </div>
      </div>
    </div>

     <!-- Available Rooms Section -->
    {% if page_obj.object_list %}
    <section class="rooms-section">
      <div class="rooms-header">
        <h2> Active Chat Rooms</h2>
        <p>Join an ongoing conversation or browse all {{ total_rooms }} available rooms</p>
      </div>
      
      <div class="rooms-grid">
        {% for room_data in page_obj.object_list|slice:":6" %}
        <div class="room-card">
          <div class="room-name" title="{{ room_data.room.get_display_name }}">
            {{ room_data.room.get_display_name }}
          </div>
          <div class="room-code">{{ room_data.room.code }}</div>
          
          <div class="room-stats">
            <div class="stat">
              <span>ðŸ‘¥</span>
              <span>{{ room_data.room.user_count }} member{{ room_data.room.user_count|pluralize }}</span>
            </div>
            <div class="stat">
              {% if room_data.online_count > 0 %}
                <span class="online-indicator"></span>
                <span>{{ room_data.online_count }} online</span>
              {% else %}
                <span style="opacity: 0.6;">ðŸ’¤ Quiet</span>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      {% if total_rooms > 6 %}
      <div style="text-align: center; margin-top: 30px;">
        <a href="{% url 'browse_rooms' %}" class="browse-all-btn">
          View All {{ total_rooms }} Rooms â†’
        </a>
      </div>
      {% endif %}
    </section>
    {% else %}
    <section class="rooms-section">
      <div class="no-rooms">
        <h3>ðŸš€ Be the first to create a room!</h3>
        <p>No chat rooms available yet. Start a conversation by creating the first room above.</p>
      </div>
    </section>
    {% endif %}

    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 2025 GroupChat App | Built by Mayank Patel</p>
    </footer>
  </body>
</html>
